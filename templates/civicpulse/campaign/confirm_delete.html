{% extends 'base.html' %}

{% block title %}Delete Campaign - {{ campaign.name }} - CivicPulse{% endblock %}

{% block extra_css %}
<style>
    .delete-warning {
        background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
        color: white;
        padding: 2rem;
        border-radius: 12px;
        margin-bottom: 2rem;
    }

    .delete-warning h1 {
        font-size: 1.75rem;
        margin-bottom: 0.5rem;
    }

    .delete-warning p {
        margin-bottom: 0;
        opacity: 0.95;
    }

    .campaign-summary-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        border: 1px solid #e2e8f0;
        margin-bottom: 1.5rem;
    }

    .campaign-summary-card h5 {
        color: var(--cp-primary);
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--cp-primary);
    }

    .info-row {
        display: flex;
        padding: 0.75rem 0;
        border-bottom: 1px solid #f1f5f9;
    }

    .info-row:last-child {
        border-bottom: none;
    }

    .info-label {
        font-weight: 600;
        color: #64748b;
        min-width: 150px;
    }

    .info-value {
        color: #334155;
    }

    .status-badge {
        padding: 0.35rem 0.85rem;
        border-radius: 12px;
        font-size: 0.875rem;
        font-weight: 600;
        display: inline-block;
    }

    .status-active {
        background-color: #dcfce7;
        color: #166534;
    }

    .status-paused {
        background-color: #fef3c7;
        color: #92400e;
    }

    .status-completed {
        background-color: #e5e7eb;
        color: #374151;
    }

    .status-archived {
        background-color: #f3f4f6;
        color: #6b7280;
    }

    .consequences-card {
        background-color: #fef3c7;
        border-left: 4px solid #f59e0b;
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
    }

    .consequences-card h5 {
        color: #92400e;
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 1rem;
    }

    .consequences-card ul {
        margin-bottom: 0;
        padding-left: 1.5rem;
    }

    .consequences-card li {
        margin-bottom: 0.5rem;
        color: #78350f;
    }

    .consequences-card li:last-child {
        margin-bottom: 0;
    }

    .confirmation-checkbox {
        background-color: #fee2e2;
        border: 2px solid #dc2626;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
    }

    .confirmation-checkbox .form-check-input:checked {
        background-color: #dc2626;
        border-color: #dc2626;
    }

    .confirmation-checkbox label {
        font-weight: 600;
        color: #991b1b;
    }

    .btn-delete-confirm {
        min-width: 200px;
    }

    .btn-delete-confirm:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">
    <!-- Breadcrumb Navigation -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{% url 'civicpulse:dashboard' %}">
                    <i class="bi bi-house-door"></i> Dashboard
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="{% url 'civicpulse:campaign-list' %}">Campaigns</a>
            </li>
            <li class="breadcrumb-item">
                <a href="{% url 'civicpulse:campaign-detail' campaign.id %}">{{ campaign.name }}</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">Delete</li>
        </ol>
    </nav>

    <!-- Delete Warning Header -->
    <div class="delete-warning">
        <h1>
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            Delete Campaign
        </h1>
        <p>
            You are about to delete the campaign "{{ campaign.name }}". Please review the information below carefully.
        </p>
    </div>

    <!-- Main Alert -->
    <div class="alert alert-danger" role="alert">
        <h5 class="alert-heading">
            <i class="bi bi-shield-exclamation me-2"></i>
            Warning: Campaign Deletion
        </h5>
        <p class="mb-0">
            This action will soft delete the campaign. The campaign will be marked as inactive but all data
            will be preserved in the system. An administrator can restore this campaign if needed.
        </p>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <!-- Campaign Summary -->
            <div class="campaign-summary-card">
                <h5>
                    <i class="bi bi-megaphone me-2"></i>
                    Campaign Summary
                </h5>
                <div class="info-row">
                    <div class="info-label">Campaign Name:</div>
                    <div class="info-value"><strong>{{ campaign.name }}</strong></div>
                </div>
                <div class="info-row">
                    <div class="info-label">Candidate:</div>
                    <div class="info-value">{{ campaign.candidate_name }}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Election Date:</div>
                    <div class="info-value">{{ campaign.election_date|date:"F d, Y" }}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Status:</div>
                    <div class="info-value">
                        <span class="status-badge status-{{ campaign.status }}">
                            {{ campaign.get_status_display }}
                        </span>
                    </div>
                </div>
                {% if campaign.organization %}
                <div class="info-row">
                    <div class="info-label">Organization:</div>
                    <div class="info-value">{{ campaign.organization }}</div>
                </div>
                {% endif %}
                {% if campaign.description %}
                <div class="info-row">
                    <div class="info-label">Description:</div>
                    <div class="info-value">{{ campaign.description|truncatewords:30 }}</div>
                </div>
                {% endif %}
            </div>

            <!-- What Will Happen -->
            <div class="consequences-card">
                <h5>
                    <i class="bi bi-info-circle-fill me-2"></i>
                    What will happen when you delete this campaign:
                </h5>
                <ul>
                    <li>
                        <strong>Campaign will be marked as inactive</strong> - The campaign will no longer appear in active campaign lists
                    </li>
                    <li>
                        <strong>All data will be preserved</strong> - Campaign information, related contact attempts, and historical data remain in the system
                    </li>
                    <li>
                        <strong>Relationships maintained</strong> - All associations with contacts and activities are kept intact
                    </li>
                    <li>
                        <strong>Reversible action</strong> - An administrator can restore this campaign and all its data if needed
                    </li>
                    <li>
                        <strong>Audit trail created</strong> - The deletion will be logged with your user account and timestamp
                    </li>
                </ul>
            </div>

            <!-- Confirmation Form -->
            <form method="post" id="deleteForm">
                {% csrf_token %}

                <div class="confirmation-checkbox">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="confirmDelete" name="confirm_delete" required>
                        <label class="form-check-label" for="confirmDelete">
                            I understand this will soft delete the campaign "{{ campaign.name }}" and want to proceed
                        </label>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="d-flex justify-content-between align-items-center">
                    <a href="{% url 'civicpulse:campaign-detail' campaign.id %}" class="btn btn-secondary btn-lg">
                        <i class="bi bi-arrow-left me-2"></i>Cancel
                    </a>

                    <button type="submit" class="btn btn-danger btn-lg btn-delete-confirm" id="deleteBtn" disabled>
                        <i class="bi bi-trash me-2"></i>Confirm Delete
                    </button>
                </div>
            </form>
        </div>

        <div class="col-lg-4">
            <!-- Additional Information -->
            <div class="card border-info mb-3">
                <div class="card-header bg-info text-white">
                    <i class="bi bi-question-circle me-2"></i>
                    Need Help?
                </div>
                <div class="card-body">
                    <h6 class="card-title">Questions about deleting campaigns?</h6>
                    <p class="card-text small">
                        If you're unsure about deleting this campaign, consider these alternatives:
                    </p>
                    <ul class="small mb-3">
                        <li>Change status to "Archived" instead</li>
                        <li>Contact an administrator for guidance</li>
                        <li>Review campaign data one more time</li>
                    </ul>
                    <a href="{% url 'civicpulse:campaign-detail' campaign.id %}" class="btn btn-sm btn-outline-info">
                        <i class="bi bi-arrow-left me-1"></i>Back to Campaign
                    </a>
                </div>
            </div>

            <!-- Restoration Info -->
            <div class="card border-secondary">
                <div class="card-header bg-secondary text-white">
                    <i class="bi bi-arrow-clockwise me-2"></i>
                    Restoration
                </div>
                <div class="card-body">
                    <h6 class="card-title">Can this be undone?</h6>
                    <p class="card-text small">
                        Yes! This is a soft delete. An administrator can restore deleted campaigns from the admin panel.
                    </p>
                    <p class="card-text small mb-0">
                        <strong>Note:</strong> Contact your system administrator if you need a deleted campaign restored.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('deleteForm');
    const deleteBtn = document.getElementById('deleteBtn');
    const confirmCheckbox = document.getElementById('confirmDelete');

    // Enable/disable delete button based on checkbox
    confirmCheckbox.addEventListener('change', function() {
        deleteBtn.disabled = !this.checked;
    });

    // Form submission with additional confirmation
    form.addEventListener('submit', function(event) {
        if (!confirmCheckbox.checked) {
            event.preventDefault();
            alert('Please confirm that you want to delete this campaign by checking the confirmation box.');
            return false;
        }

        // Double confirmation prompt
        const campaignName = '{{ campaign.name|escapejs }}';
        const confirmed = confirm(
            `Are you absolutely sure you want to delete "${campaignName}"?\n\n` +
            'This action will soft delete the campaign. Click OK to proceed or Cancel to go back.'
        );

        if (!confirmed) {
            event.preventDefault();
            return false;
        }

        // Show loading state
        deleteBtn.disabled = true;
        deleteBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Deleting...';
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Escape to cancel
        if (e.key === 'Escape') {
            window.location.href = '{% url "civicpulse:campaign-detail" campaign.id %}';
        }
    });

    // Warning on page leave if checkbox is checked
    window.addEventListener('beforeunload', function(e) {
        if (confirmCheckbox.checked && !form.classList.contains('submitted')) {
            e.preventDefault();
            e.returnValue = '';
            return '';
        }
    });

    form.addEventListener('submit', function() {
        form.classList.add('submitted');
    });

    console.log('Campaign delete confirmation initialized for: {{ campaign.name }}');
});
</script>
{% endblock %}
